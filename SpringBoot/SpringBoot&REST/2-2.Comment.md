## ğŸ’¡ RESTful êµ¬í˜„ 
## Comment ì„œë¹„ìŠ¤ = ì¢…ì†ëœ ìì› í‘œí˜„í•˜ê¸°
### URL & Method êµ¬ì„±
- ëŒ“ê¸€ì€ ê²Œì‹œê¸€ì— ì†í•¨(ì¢…ì†)
- ì–´ë–¤ ê²Œì‹œê¸€ì¸ì§€ì— ëŒ€í•œ URLì¸ `/article/{articleId}`ì— 
  - í•´ë‹¹ ìì›ì´ ê°€ì§€ê³  ìˆëŠ” ëŒ“ê¸€ì´ë¼ëŠ” ì˜ë¯¸ì˜ `/comments`ë£¨ê°€

> ğŸ’¡ `/articles/{articleId}/comments` : PKê°€ `aritcleId` ì¸ ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ì— ëŒ€í•œ ì‘ì—…ì„ ìœ„í•œ URL   
> ğŸ’¡ `/articles/{articleId}/comments/{commentId}` : PKê°€ `aritcleId` ì¸ ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ì¤‘ PKê°€ `commentId` ì¸ ëŒ“ê¸€ì— ëŒ€í•œ ì‘ì—…ì„ ìœ„í•œ URL

### URLê³¼ Method ì¡°í•©
`@RequestMapping` êµ¬ì„±
- ê²Œì‹œê¸€ì— ëŒ“ê¸€ ì¶”ê°€: `POST /articles/{articleId}/comments`
- ê²Œì‹œê¸€ ëŒ“ê¸€ ì „ì²´ ì¡°íšŒ: `GET /articles/{articleId}/comments`
- ê²Œì‹œê¸€ ëŒ“ê¸€ ìˆ˜ì •: `PUT /articles/{articleId}/comments/{commentId}`
- ê²Œì‹œê¸€ ëŒ“ê¸€ ì‚­ì œ: `DELETE /articles/{articleId}/comments`
- **ëŒ“ê¸€ ë‹¨ì¼ ì¡°íšŒ ê¸°ëŠ¥ ì¶”ê°€ x**

### `Comment` & `CommentDto`
- ê²Œì‹œê¸€ `Article`ê³¼ 1 : N ê´€ê³„ë¥¼ ê°€ì§€ëŠ” `Comment` 
```java
@Getter
@Entity
@NoArgsConstructor
public class Comment {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Setter
    private String content;
    @Setter
    private String writer;

    @Setter
    @ManyToOne
    private Article article;
    // ...
}
```
```java
@Getter
@ToString
@NoArgsConstructor
public class CommentDto {
    private Long id;
    @Setter
    private String content;
    @Setter
    private String writer;
    // ...
}
```
- ê²Œì‹œê¸€ ìª½ì—ì„œë„ ëŒ“ê¸€ì„ í™•ì¸í•  ìˆ˜ ìˆë„ë¡ `Article`, `ArticleDto` ìˆ˜ì •
  - `ArticleDto`ì—ë„ `CommentDto` ì¶”ê°€
 
- `Article` 
```java
@Getter
@Entity
@NoArgsConstructor
public class Article {
    // ...

    @OneToMany(mappedBy = "article")
    private final List<Comment> comments = new ArrayList<>();

    // ...
}
```
- `ArticleDto`
```java
@Getter
@ToString
@NoArgsConstructor
public class ArticleDto {
    // ...
    private List<CommentDto> comments = new ArrayList<>();
    // ...
}
```

### `CommentController`
- ëª¨ë“  ìš”ì²­ URLì´ `/articles/{articleId}`ë¡œ ì‹œì‘
- `@RequestMapping`ì„ í´ë˜ìŠ¤ì— ì¶”ê°€í•´ í•´ë‹¹ ë‚´ìš© ë°˜ì˜ ê°€ëŠ¥
- ë‚´ë¶€ ë©”ì„œë“œì—ì„œ `articleId`ë¥¼ í™œìš©í•´ì•¼ í•œë‹¤ë©´ `@PathVariable` ì‚¬ìš©
```java
@Slf4j
@RequiredArgsConstructor
@RestController
@RequestMapping("/articles/{articleId}/comments")
public class CommentController {
    private final CommentService service;

    @PostMapping
    public CommentDto create(
            @PathVariable("articleId") Long articleId,
            @RequestBody CommentDto dto
    ) {
        return service.createComment(articleId, dto);
    }

    @GetMapping
    public List<CommentDto> readAll(
            @PathVariable("articleId") Long articleId
    ) {
        return service.readCommentAll(articleId);
    }

    @PutMapping("/{commentId}")
    public CommentDto update(
            @PathVariable("articleId") Long articleId,
            @PathVariable("commentId") Long commentId,
            @RequestBody CommentDto dto
    ) {
        return service.updateComment(articleId, commentId, dto);
    }

    @DeleteMapping("/{commentId}")
    public void delete(
            @PathVariable("articleId") Long articleId,
            @PathVariable("commentId") Long commentId
    ) {
        service.deleteComment(articleId, commentId);
    }
}
```
### `CommentService`
- ëŒ“ê¸€ì„ ë‹¬ê¸° ìœ„í•œ `CommentService`
- `create` : ì‘ì„± ëŒ€ìƒ ê²Œì‹œê¸€ì„ ì§€ì •í•˜ëŠ” ìš©ë„ë¡œ í™œìš© ê°€ëŠ¥
- `readAll` : ê²Œì‹œê¸€ì„ ê¸°ì¤€ìœ¼ë¡œ ëª¨ë“  ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸° ê°€ëŠ¥
- `update` : ìˆ˜ì •í•˜ê³ ì í•˜ëŠ” ëŒ“ê¸€ì´ ë“±ë¡ëœ ëŒ€ìƒ `article`ì˜ PKì™€ ì „ë‹¬ë°›ì€ `articleId`ê°€ ë‹¤ë¥¼ ê²½ìš°, ìˆ˜ì • ê±°ë¶€ ê°€ëŠ¥
- `delete` : ì‚­ì œí•˜ê³ ì í•˜ëŠ” ëŒ“ê¸€ì´ ë“±ë¡ëœ ëŒ€ìƒ `article`ì˜ PKì™€ ì „ë‹¬ë°›ì€ `articleId`ê°€ ë‹¤ë¥¼ ê²½ìš°, ì‚­ì œ ê±°ë¶€ ê°€ëŠ¥
```java
@Slf4j
@Service
@RequiredArgsConstructor
public class CommentService {
    private final ArticleRepository articleRepository;
    private final CommentRepository commentRepository;

public CommentDto createComment(Long articleId, CommentDto dto) {
        Optional<Article> optionalArticle
                = articleRepository.findById(articleId);
        if (optionalArticle.isEmpty())
            throw new ResponseStatusException(HttpStatus.NOT_FOUND);

        Comment newComment = new Comment();
        newComment.setWriter(dto.getWriter());
        newComment.setContent(dto.getContent());
        newComment.setArticle(optionalArticle.get());
        newComment = commentRepository.save(newComment);
        return CommentDto.fromEntity(newComment);
    }

public List<CommentDto> readAll(Long articleId) {
        if (!articleRepository.existsById(articleId))
            throw new ResponseStatusException(HttpStatus.NOT_FOUND);
        List<CommentDto> commentList = new ArrayList<>();
        // Query Method
        for (Comment entity: commentRepository
                .findAllByArticleId(articleId)) {
            commentList.add(CommentDto.fromEntity(entity));
        }
        return commentList;
    }

    public CommentDto updateComment(
            Long articleId,
            Long commentId,
            CommentDto dto
    ) {
        Optional<Comment> optionalComment
                = commentRepository.findById(commentId);
        if (optionalComment.isEmpty())
            throw new ResponseStatusException(HttpStatus.NOT_FOUND);


        Comment comment = optionalComment.get();
        if (!articleId.equals(comment.getArticle().getId()))
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST);

        comment.setContent(dto.getContent());
        comment.setWriter(dto.getWriter());
        return CommentDto.fromEntity(commentRepository.save(comment));
    }

    public void deleteComment(Long articleId, Long commentId) {
        Optional<Comment> optionalComment
                = commentRepository.findById(commentId);
        if (optionalComment.isEmpty())
            throw new ResponseStatusException(HttpStatus.NOT_FOUND);

        Comment comment = optionalComment.get();
        if (!articleId.equals(comment.getArticle().getId()))
            throw new ResponseStatusException(HttpStatus.BAD_REQUEST);

        commentRepository.deleteById(commentId);
    }
}
```