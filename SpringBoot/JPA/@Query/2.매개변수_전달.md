## `@Query`
### ë§¤ê°œë³€ìˆ˜ ì „ë‹¬
- `?n`ì„ ì´ìš©í•´ ë©”ì„œë“œ ë§¤ê°œë³€ìˆ˜ì˜ ìˆœì„œëŒ€ë¡œ `?n`ì˜ ìœ„ì¹˜ì— ëŒ€ì¹˜
```java
@Query("SELECT l FROM Lecture l " +
        "WHERE l.startTime = ?1 AND l.endTime = ?2")
List<Lecture> findLecturesByTime(Integer startTime, Integer endTime);

@Query(
        value = "SELECT * FROM lecture " +
                "WHERE start_time = ?1 AND end_time = ?2",
        nativeQuery = true
)
List<Lecture> findLecturesByTimeNative(Integer startTime, Integer endTime);
```
- ë§¤ê°œë³€ìˆ˜ ìˆœì„œì— ë§ê²Œ `?n`ì— í• ë‹¹
```java
@Query("SELECT l FROM Lecture l WHERE l.startTime = ?2 AND l.endTime = ?1")
List<Lecture> findLecturesByTime(Integer startTime, Integer endTime);
```
- ë§Œì•½ ìœ„ì™€ ê°™ì´ ì‘ì„±í•˜ê²Œ ëœë‹¤ë©´ ì‹¤ì œ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ì˜ ê²½ìš° ì•„ë˜ ì²˜ëŸ¼ ì‘ë™
```sql
SELECT l FROM Lecture l WHERE l.startTime = endTime AND l.endTime = startTime
```
- `n`ì´ ëª‡ë²ˆì¨° ë§¤ê°œë³€ìˆ˜ì¸ì§€ë¥¼ ë‚˜íƒ€ëƒ„
---
- `Named Parameter` : ë§¤ê°œë³€ìˆ˜ ìˆœì„œì— ì‹ ê²½ì“°ì§€ ì•Šê³  ì´ë¦„ì„ ê¸°ì¤€ìœ¼ë¡œ ì „ë‹¬
- `:name` í˜•ì‹ìœ¼ë¡œ ì‘ì„±
- ë©”ì„œë“œì˜ ë§¤ê°œë³€ìˆ˜ì— `@Param` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ í•´ë‹¹ ìœ„ì¹˜ì— ë“¤ì–´ê°€ëŠ” ë§¤ê°œë³€ìˆ˜ì„ì„ ë‚˜íƒ€ëƒ„
```sql
@Query("SELECT l FROM Lecture l " +
        "WHERE l.startTime = :start AND l.endTime = :end")
List<Lecture> findLecturesByTimeNamed(
        @Param("start") Integer startTime,
        @Param("end") Integer endTime
);


@Query(
        value = "SELECT * FROM lecture " +
                "WHERE start_time = :start AND end_time = :end",
        nativeQuery = true
)
List<Lecture> findLecturesByTimeNamedNative(
        @Param("start") Integer startTime,
        @Param("end") Integer endTime
);
```
- ë§¤ê°œë³€ìˆ˜ ì´ë¦„ì´ ì¤‘ìš”í•œ ê²ƒì´ ì•„ë‹ˆë¼ `@Param`ì— ì „ë‹¬ëœ ì´ë¦„ê³¼ Queryì— ì‚¬ìš©ëœ ì´ë¦„ì´ ì¼ì¹˜í•´ì•¼ í•¨
- `WHERE`ì ˆì—ì„œ `IN`ì´ë‚˜ `NOT IN` ì‚¬ìš© ê°€ëŠ¥ => `Collection`í˜•íƒœë¡œ ì „ë‹¬
```java
@Query("SELECT l FROM Lecture l WHERE l.day IN :days")
List<Lecture> findByDayIn(@Param("days") Collection<String> days);
```
---
### `@Modifying`
- `UPDATE` / `DELETE`ì˜ ê²½ìš° `@Modifying`ì¶”ê°€ë¡œ í•„ìš”í•¨
```java
// 3ì‹œê°„ ì´ìƒ ì§„í–‰í•˜ëŠ” ê°•ì˜ì˜ ì‹œê°„ì„ 3ì‹œê°„ìœ¼ë¡œ ì¡°ì •
@Modifying
@Query("UPDATE Lecture l " +
        "SET l.endTime = l.startTime + 3 " +
        "WHERE l.endTime - l.startTime > 3")
Integer setLectureMaxHour3();

// ì§€ë„êµìˆ˜ê°€ ì—†ëŠ” í•™ìƒì˜ ì§€ë„êµìˆ˜ ì§€ì •
@Modifying
@Query("UPDATE Student s " +
        "SET s.advisor = :advisor " +
        "WHERE s.advisor IS null")
Integer setAdvisorForStudent(
        @Param("advisor") Instructor instructor
);

// ì§€ë„í•™ìƒì´ ì—†ëŠ” êµìˆ˜ë¥¼ ì‚­ì œ
@Modifying
@Query("DELETE FROM Instructor i " +
        "WHERE size(i.advisingStudents) = 0")
Integer sackInstructorsNotAdvising();
```
> ğŸ’¡ `size()` : JPQLì˜ í•¨ìˆ˜(function)    

- `INSERT`ì˜ ê²½ìš° JPQLì´ ì§€ì›í•˜ì§€ ì•ŠìŒ
- `nativeQuery`ë¥¼ ì„¤ì •í•˜ì—¬ SQL `INSERT`ë¬¸ ì‘ì„±
- `@Modifying`í•„ìš”
```java
@Modifying
@Query(
        value = "INSERT INTO lecture(name, start_time, end_time, instructor_id, day) " +
                "VALUES (:name, :startTime, :endTime, :instructorId, :day)",
        nativeQuery = true
)
void insertLecture(
        @Param("name") String name,
        @Param("startTime") Integer startTime,
        @Param("endTime") Integer endTime,
        @Param("instructorId") Long instructorId,
        @Param("day") String day
);
```