## Relations
### ManyToMany
- M:N, Many To Many
- í…Œì´ë¸”ì˜ ë ˆì½”ë“œë“¤ì´ ì–‘ë°©í–¥ìœ¼ë¡œ ë³µìˆ˜ì˜ ì—°ê´€ ê´€ê³„ë¥¼ ê°€ì§€ëŠ” ê´€ê³„
- ëŒ€í‘œì ìœ¼ë¡œ **ì¢‹ì•„ìš”**ê¸°ëŠ¥
  - í•˜ë‚˜ì˜ ê²Œì‹œê¸€ì€ ì—¬ëŸ¬ ì‚¬ìš©ìì—ê²Œ **ì¢‹ì•„ìš”**ë¥¼ ë°›ì„ ìˆ˜ ìˆìŒ
  - í•œëª…ì˜ ì‚¬ìš©ìëŠ” ì—¬ëŸ¬ ê²Œì‹œê¸€ì„ **ì¢‹ì•„ìš”**í•  ìˆ˜ ìˆìŒ
- ë˜ëŠ” í•™ìƒê³¼ ê°•ì˜ì˜ ê´€ê³„
  - í•œ í•™ìƒì€ ì—¬ëŸ¬ ê°•ì˜ë¥¼ ìˆ˜ê°•
  - í•œ ê°•ì˜ì—ëŠ” ì—¬ëŸ¬ í•™ìƒë“¤ì´ ì°¸ì„


> ğŸ’¡ ì´ëŸ¬í•œ ê´€ê³„ë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ì„œëŠ” ì–‘ìª½ í…Œì´ë¸”ì˜ PKë¥¼ ì™¸ë˜í‚¤ë¡œ ê°–ëŠ” ì œ 3ì˜ í…Œì´ë¸”ì´ í•„ìš”,    
> ê¸°ë³¸ì ìœ¼ë¡œ ì–‘ìª½ë‹¤ 1:N ì—ì„œ 1ì˜ ì—­í• ì„ í•˜ê¸° ë•Œë¬¸ì— ë‹¤ìˆ˜ì˜ ì—­í• ì„ í•˜ëŠ” í…Œì´ë¸”ì„ ë³„ë„ë¡œ ìƒì„±


![STUDENT-LECTURE ERD](student-lecture.png)
---
### `@ManytoMany`
- `Student` Entity
```java
@Entity
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String firstName;
    private String lastName;
}
```
- `Lecture` Entity
```java
@Entity
public class Lecture {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private String day;
    private Integer startTime;
    private Integer endTime;
}
```
- ë‘ Entityë¥¼ M:N ì—°ê´€ ê´€ê³„ë¡œ ì„¤ì •í•˜ê¸° ìœ„í•´ì„œ `@ManyToMany` ì–´ë…¸í…Œì´ì…˜ í™œìš©
```java
@Entity
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String firstName;
    private String lastName;

    @ManyToMany
    @JoinTable(name = "attending_lectures")
    private final List<Lecture> attending = new ArrayList<>();
}
```
- `JoinTable` : `JoinColumn`ê³¼ ë¹„ìŠ·í•œ ì—­í• , `@ManyToMany` ê´€ê³„ë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•´ í•„ìš”í•œ Join Tableì˜ í˜•íƒœë¥¼ ì¡°ì •í•˜ê¸° ìœ„í•œ ìš©ë„(í…Œì´ë¸” ì´ë¦„ ì„¤ì •)
- ë°˜ëŒ€ìª½ì—ì„œ `@ManyToMany` ê´€ê³„ì˜ ë ˆì½”ë“œë¥¼ ì°¾ê³  ì‹¶ë‹¤ë©´ í•´ë‹¹ ì†ì„±ì˜ `@ManyToMany`ë¥¼ ì‘ì„±
- íŠ¹ë³„í•œ ì„¤ì •ì„ í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ í•´ë‹¹ ë‘ `@ManyToMany`ê°€ ê°™ì€ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì–´ë…¸í…Œì´ì…˜ì¸ì§€ ì¸ì§€í•  ìˆ˜ ì—†ê³  ë¶ˆí•„ìš”í•œ í…Œì´ë¸”ì´ ìƒì„±
- `maapedBy` ì†ì„± ì‚¬ìš©
```java
@Entity
public class Lecture {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private String day;
    private Integer startTime;
    private Integer endTime;

    @ManyToMany(mappedBy = "attending")
    private final List<Student> students = new ArrayList<>();
}
```
- `mappedBy = "attending"` : `Student`ì˜ attendingì´ë¼ëŠ” ê°ì²´ì™¸ ë§¤í•‘ë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸
- Join Tableì˜ ë ˆì½”ë“œë¥¼ ì¶”ê°€í•˜ê³  ì‹¶ë‹¤ë©´ í•„ë“œì˜ ì»¬ë ‰ì…˜ ìë£Œí˜•ì— ì—°ê´€ê´€ê³„ë¥¼ ë§ºê³ ì í•˜ëŠ” ì—”í‹°í‹°ë¥¼ ì¶”ê°€í•œ ë’¤, `repository`ë¥¼ ì´ìš©í•´ ì €ì¥
```java
Optional<Student> optionalStudent 
        = studentRepository.findById(id);
if (optionalStudent.isEmpty())
    throw new ResponseStatusException(HttpStatus.NOT_FOUND);
Optional<Lecture> optionalLecture 
        = lectureRepository.findById(lectureId);
if (optionalLecture.isEmpty())
    throw new ResponseStatusException(HttpStatus.NOT_FOUND);

Student student = optionalStudent.get();
Lecture lecture = optionalLecture.get();

student.getAttending().add(lecture);
studentRepository.save(student);
```
- `optionalStudent`ì™€ `optionalLecture`ê°€ ëª¨ë‘ ë¹„ì–´ ìˆì§€ ì•Šë‹¤ë©´, ê°ê°ì˜ Optional ê°ì²´ì—ì„œ ê°ê°ì˜ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜´(get() ë©”ì„œë“œë¥¼ ì‚¬ìš©)
- í•™ìƒì´ í•´ë‹¹ ê°•ì˜ë¥¼ ì°¸ì„í•˜ë„ë¡ ì„¤ì •
  - `getAttending()` : í•™ìƒì´ ì°¸ì„í•˜ëŠ” ê°•ì˜ë“¤ì„ ë‚˜íƒ€ë‚´ëŠ” ì»¬ë ‰ì…˜(Entityì—ì„œ ë‹¤ëŒ€ë‹¤ ë§¤í•‘)
- `Optional`ì„ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì—”í‹°í‹°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‘ì—…ì´ ì‹¤íŒ¨í•  ê°€ëŠ¥ì„± ë•Œë¬¸