## Relations ğŸ’¡
### ì˜ì†ì„± ì „ì´ - Cascade
ì˜ì†ì„± ì „ì´(Persistence Cascade) 
- ë¶€ëª¨ ì—”í‹°í‹°ì˜ ìƒíƒœ ë³€í™”ê°€ ìì‹ ì—”í‹°í‹°ì— ì˜í–¥ì„ ì£¼ëŠ” ê²ƒ 
- ex) ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ ìë™ìœ¼ë¡œ ê´€ë ¨ëœ ìì‹ ì—”í‹°í‹°ë„ ì €ì¥ë˜ëŠ” ê²ƒ

---
- ì¼ë°˜ì ì¸ ìƒí™©ì—ì„œ `@OneToMany` ê´€ê³„ë¥¼ ì‚¬ìš©í•  ë•Œ, ì£¼ë¡œ `@ManyToOne`ê³¼ í•¨ê»˜ ì–‘ë°©í–¥ ê´€ê³„ë¡œ í™œìš©
- `mappedBy`ë¥¼ ì´ìš©í•´ `@OneToMany`ì™€ ì—°ê²°ë˜ì–´ ìˆëŠ” `@ManyToOne` ì†ì„±ì„ ì§€ì •
- ì´ëŠ” ê´€ê³„ì˜ ì£¼ê°€ ë˜ëŠ” ì†ì„±ì´ ëˆ„êµ°ì§€ ì§€ì •í•˜ëŠ” ê²ƒ
```java
@Entity
public class Student {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private Integer age;
    private String phone;
    private String email;

    @ManyToOne
    private Instructor advisor;

    @ManyToMany
    @JoinTable(name = "attending_lectures")
    private final List<Lecture> attending = new ArrayList<>();
}
```
```java
@Entity
public class Instructor {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    @OneToMany(mappedBy = "advisor")
    private List<Student> advisingStudents;
}
```
---
```java
Instructor instructor = Instructor.builder()
        .name("Linus Torvalds")
        .build();

Student alex = Student.builder()
        .name("alex")
        .advisor(instructor)
        .build();
Student brad = Student.builder()
        .name("brad")
        .advisor(instructor)
        .build();

instructor.getAdvisingStudents().add(alex);
instructor.getAdvisingStudents().add(brad);
instructorRepository.save(instructor);
```
- `Instructor`ê°ì²´ì˜ `advisingStudents`ì— ì—¬ëŸ¬ `Student` ê°ì²´ë¥¼ ë„£ê³  `instructorRepository.save()`ë¥¼ í˜¸ì¶œí•˜ë”ë¼ë„
- ì‹¤ì œë¡œ í•´ë‹¹í•˜ëŠ” `Student` ê°ì²´ë“¤ì´ ì €ì¥ë˜ì§€ ì•ŠìŒ, `instructor`ë§Œ ì €ì¥
- `@OneToMany`ì™€ `@ManyToOne` Entity ë‘˜ì˜ ê´€ê³„ì—ì„œ ë°ì´í„°ì˜ ì£¼ë„ê¶Œì„ ê°–ê³  ìˆëŠ” EntityëŠ” **`@ManyToOne`ìœ¼ë¡œ í‘œí–”ë˜ëŠ” FK**ë¥¼ ê°–ëŠ” `Student`
- ğŸ’¡ ê·¸ëŸ¬ë¯€ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ì„œëŠ” ë§Œë“¤ì–´ì§„ `Instructor`ê°ì²´ë¥¼ `Student`ì— ì „ë‹¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ìƒì„± 
```java
Instructor instructor = Instructor.builder()
          .name("Linus Torvalds")
          .build();
  instructor = instructorRepository.save(instructor);
  List<Student> students = new ArrayList<>();
  students.add(Student.builder()
          .name("alex")
          .advisor(instructor)
          .build());
  students.add(Student.builder()
          .name("brad")
          .advisor(instructor)
          .build());
  studentRepository.saveAll(students);
```
- `@OneToMany` í•„ë“œì˜ ì˜ì†ì„± ì „ì´(`cascade`) ì˜µì…˜ì„ ì¡°ì •í•˜ì–´ `Instructor`ì˜ ë³€ê²½ ì‚¬í•­ì´ ì €ì¥ë  ë•Œ, ê·¸ì— ë”°ë¥¸ ì˜ì†ì„± ë³€í™”ë¥¼ `Student`ì— ì „ë‹¬
---
### `CascadeType` ì˜µì…˜
- `ALL` : ì•„ë˜ ëª¨ë“  ì„¤ì • ì‚¬ìš© 
- `PERSIST` : ì €ì¥ë  ë•Œ ì—°ê´€ëœ Entityë¥¼ ê°™ì´ ì €ì¥
- `REMOVE` : ì œê±°ë  ë•Œ ì—°ê´€ëœ Entityë¥¼ ê°™ì´ ì œê±°
- `MERGE`,`REFRESH`,`DETACH`...

### `CascadeType.PERSIST`
- `PERSIST` : ì €ì¥ë  ë•Œ ì—°ê´€ëœ Entityë¥¼ ê°™ì´ ì €ì¥
```java
@Entity
public class Instructor {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    @OneToMany(mappedBy = "advisor", cascade = CascadeType.PERSIST)
    private final List<Student> advisingStudents = new ArrayList<>();
}
```
- `PERSIST`ëŠ” ì§€ì†í•˜ë‹¤ëŠ” ëœ»
- `instructor`ì˜ `advisingStudent`ì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê³  ì €ì¥í•  ë•Œ, ì €ì¥ë˜ì§€ ì•Šì€ `Student` Entityë¥¼ ì „ë¶€ ì €ì¥í•˜ëŠ” ì˜µì…˜
- ì‹¤í–‰ ìˆœì„œ
  - 1. `INSERT INTO instructor` ì‹¤í–‰
  - 2. `Student`ë¥¼ ìœ„í•œ `INSERT INTO student` ì‹¤í–‰


### `CascadeType.REMOVE`
- `REMOVE` : ì œê±°ë  ë•Œ ì—°ê´€ëœ Entityë¥¼ ê°™ì´ ì œê±°
```java
@Entity
public class Instructor {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;

    @OneToMany(mappedBy = "advisor", cascade = CascadeType.REMOVE)
    private final List<Student> advisingStudents = new ArrayList<>();
}
```
- `REMOVE`ëŠ” ì œê±°í•œë‹¤ëŠ” ëœ»
- `PERSIST`ì™€ ë°˜ëŒ€ë¡œ ë™ì‘
- ì €ì¥í•  ë•Œ ë³€ê²½ì‚¬í•­ì„ ê°™ì´ ë°˜ì˜í•˜ëŠ” ê²Œ `PERSIST` / `REMOVE`ëŠ” ë°ì´í„°ë¥¼ ì‚­ì œí•  ë•Œ ì—°ê´€ ë°ì´í„°ë¥¼ ì‚­ì œ
  - ex) `Student` ë‘˜ ìƒì„±, `Instructor` í• ë‹¹ , ì €ì¥ í›„ ë‹¤ì‹œ `Instructor` ì‚­ì œ
```java
Instructor instructor = Instructor.builder()
        .name("Linus Torvalds")
        .build();
instructor = instructorRepository.save(instructor);
List<Student> students = new ArrayList<>();
students.add(Student.builder()
        .name("alex")
        .advisor(instructor)
        .build());
students.add(Student.builder()
        .name("brad")
        .advisor(instructor)
        .build());
studentRepository.saveAll(students);

// ...

instructorRepository.deleteById(id);
```
![Cascade-remove](Casecade-remove.png)
1. `Student` ë°ì´í„° ì‚­ì œ ë˜ê¸° ì „ `@ManyToMany` ì˜ Join Table(student_attending) ë°ì´í„° ì‚­ì œ
2. `Instructor`ê°€ ë°ì´í„° ì‚­ì œ ë˜ê¸° ì „, `Student` ë°ì´í„° ì‚­ì œ
3. `Instructor` ë°ì´í„° ì‚­ì œ