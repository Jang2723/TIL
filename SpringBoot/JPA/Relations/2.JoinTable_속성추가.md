## Relations 
### Join Tableì— ì†ì„± ì¶”ê°€
- ì‹¤ë¬´ì—ì„œ `@ManyToMany` í•˜ë‚˜ë§Œìœ¼ë¡œëŠ” M:N ê´€ê³„ë¥¼ ìƒì„±í•˜ê¸° í˜ë“  ê²½ìš°ë„ ì¡´ì¬
  - ex) ì£¼ë¬¸ì •ë³´


![shop ERD](shop_ERD.png)
- ì£¼ë¬¸ ì •ë³´ëŠ” ê³ ê°ê³¼ ìƒí’ˆì˜ M:N ê´€ê³„
- ì£¼ë¬¸ ì •ë³´ëŠ” ë¬¼í’ˆ ë°°ì†¡ì§€, êµ¬ë§¤ ê°¯ìˆ˜, ì´ ì§€ë¶ˆ ê¸ˆì•¡ ë“± ë‹¤ì–‘í•œ ì •ë³´ í¬í•¨
- ì´ëŸ° í…Œì´ë¸”ì„ í‘œí˜„í•  ë•Œ, `@JoinTable`, `@JoinColumn`ì„ ì´ìš©
```java
@Entity
public class Customer {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private String phone;
    private String email;

    @ManyToMany(mappedBy = "customers")
    private final List<Item> items = new ArrayList<>();
}
```
```java
@Entity
public class Item {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private String description;
    private Integer price;

    @ManyToMany
    private final List<Customer> customers = new ArrayList<>();
}
```
- `@JoinTable`ì„ ì´ìš©í•´ Join Tableì˜ ëª¨ìŠµì„ ì •ì˜
```java
@Entity
public class Item {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private String description;
    private Integer price;

    @ManyToMany
    @JoinTable(
            name = "customer_order",
            joinColumns = @JoinColumn(name = "item_id"),
            inverseJoinColumns = @JoinColumn(name = "customer_id")
    )
    private final List<Customer> customers = new ArrayList<>();
}
```
- `joinColumns`ì™€ `inverseJoinColumns`ë¥¼ í†µí•´ ë§Œë“¤ì–´ì§ˆ Join Tableì´ ê°€ì ¸ì•¼ í•  ì»¬ëŸ¼ì˜ ì´ë¦„ ì •ì˜
- `joinColumns` : í˜„ì¬ Entityì˜ idë¥¼ FKë¡œ ê°–ëŠ” ì»¬ëŸ¼ì˜ ì´ë¦„ì„ ì§€ì •/ Itemì˜ ì™œë˜í‚¤ì— ëŒ€í•œ ì •ë³´
- `inverseJoinColumns` : ëŒ€ìƒ Entityì˜ idë¥¼ FKë¡œ ê°–ëŠ” ì»¬ëŸ¼ì˜ ì´ë¦„ì„ ì§€ì •

> ì¦‰,  `joinColumns`ì—ì„œëŠ” Item ì—”í‹°í‹°ì˜ ì£¼ í‚¤(ì¼ë°˜ì ìœ¼ë¡œ id)ë¥¼ ì°¸ì¡°í•˜ì—¬ í˜„ì¬ ì—”í‹°í‹°ë¥¼ ì‹ë³„í•˜ê³ ,    
> `inverseJoinColumns`ì—ì„œëŠ” Customer ì—”í‹°í‹°ì˜ ì£¼ í‚¤(ì¼ë°˜ì ìœ¼ë¡œ id)ë¥¼ ì°¸ì¡°í•˜ì—¬ ëŒ€ìƒ ì—”í‹°í‹°ë¥¼ ì‹ë³„   
> ğŸ’¡ ë§Œì•½ ì´ ì„¤ì •ì„ Customerì—ì„œ í•  ê²½ìš° `joinColums`ì—ëŠ” Customer ê°€ ë“¤ì–´ê°€ê³ , `inverseJoinColumns`ì—ë„Œ Itemì´ ë“¤ì–´ê°

---
- `@JoinTable`ì„ ì´ìš©í•˜ì—¬ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë§¤í•‘í•  ë•ŒëŠ” ì¤‘ê°„ í…Œì´ë¸”ì´ í•„ìš”
- `Customer`ì™€ `Item`ê°„ì˜ ë‹¤ëŒ€ë‹¤ ê´€ê³„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” í…Œì´ë¸”ì˜ ì´ë¦„ì„ ìœ„ì—ì„œ `customer_order`ë¼ê³  ì •ì˜í–ˆê¸° ë•Œë¬¸ì— ì´ì— ëŒ€í•œ ì—”í‹°í‹° í´ë˜ìŠ¤ê°€ í•„ìš”
- `@JoinTable`ì˜ ì •ì˜ì™€ ë™ì¼í•œ Entity ìƒì„±
```java
@Entity
@Table(name = "customer_order")
public class Order {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne
    @JoinColumn(name = "item_id")
    private Item item;

    @ManyToOne
    @JoinColumn(name = "customer_id")
    private Customer customer;

    private String address;
}
```
- `@JoinTable` ì–´ë…¸í…Œì´ì…˜ì—ì„œ ì •ì˜ì™€ ì¼ì¹˜í•˜ë„ë¡
  - `@Table`ë¡œ ì´ë¦„ì„ ì„¤ì •
  - `@ManyToOne`ì—ëŠ” `@JoinColumn` ì¶”ê°€
- `order`ëŠ” `Item`ê³¼ `Customer`ì™€ ê°ê° N:1 ê´€ê³„
- ê°œë³„ Entityë¥¼ ë°”íƒ•ìœ¼ë¡œ `JoinTable`ì˜ Entityë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
- í…ŒìŠ¤íŠ¸ ì½”ë“œ
```java
// ê³ ê° ìƒì„±
Customer customer = Customer.builder()
        .name("alex")
        .build();
customer = customerRepository.save(customer);

// ìƒí’ˆ ìƒì„±
Item item = Item.builder()
        .name("mouse")
        .build();
item = itemRepository.save(item);

item.getCustomers().add(customer);
item = itemRepository.save(item);

Optional<Order> optionalOrder = orderRepository.findByItemAndCustomer(item, customer);
```
- Itemê³¼ Customerì˜ ê´€ê³„ë¥¼ ì„¤ì •í•˜ë©´ Orderë„ ê°™ì´ ìƒì„±
```java
Item item = itemRepository.findFirstByName("mouse").get();
log.info(String.valueOf(item.getCustomers().size()));
```