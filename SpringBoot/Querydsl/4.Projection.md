## Projection
- í•˜ë‚˜ì˜ ì†ì„±ë§Œ ì¡°íšŒí•œë‹¤ë©´, í•´ë‹¹ ì†ì„±ì˜ íƒ€ì…ìœ¼ë¡œ ê²°ê³¼ê°€ ë‚˜ì˜´
```java
// ë‹¨ì¼ ì†ì„± ì¡°íšŒ
String name = queryFactory
        .select(item.name)
        .from(item)
        .where(item.name.eq("itemA"))
        .fetchOne();

// ì§‘ê³„í•¨ìˆ˜ ë‹¨ì¼ ì¡°íšŒ
Long count = queryFactory
        .select(item.count())
        .from(item)
        .join(item.shop)
        .where(item.shop.name.eq("shopA"))
        .fetchOne();
```
- ì—¬ëŸ¬ ê²°ê³¼ëŠ” Tupleí˜•ìœ¼ë¡œ
```java
List<Tuple> results = queryFactory
        .select(item.name, item.price)
        .from(item)
        .fetch();

results.forEach(tuple -> System.out.printf{
    "%s: %d%n",
        tuple.get(item.name)
        tuple.get(item.price)
});
```
- `Tuple`ì€ ê¸°ë³¸ì ìœ¼ë¡œ Querydslì´ ì œê³µí•˜ëŠ” ê¸°ëŠ¥
- ì¼ë°˜ì ì¸ DTOë¥¼ ì´ìš©í•´ ê²°ê³¼ë¥¼ ì”ë‹¬ë°›ê³  ì‹¶ì„ ê²½ìš° 
  - JPQLë¡œ í•œë‹¤ë©´ JPQL ë‚´ë¶€ì—ì„œ ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜ Spring Data Projection ì´ìš©
```java
@Query("SELECT new com.<ìƒëµ>.ILCountDto(l.instructor, COUNT(*)) " +
        "FROM Lecture l GROUP BY l.instructor " +
        "ORDER BY COUNT(*) DESC, l.instructor.id")
List<ILCountDto> selectILCountDto();
```
- Querydslì€ ì´ë³´ë‹¤ íš¨ìœ¨ì ì¸ ë°©ì‹ìœ¼ë¡œ, DTOì— ì—°ê²°í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ê°€ì§€ê³  ì‡ìŒ

### DTOë¡œ ë°˜í™˜í•˜ê¸°
- DTO ìƒì„±, ê¸°ë³¸ìƒì„±ìë„ ë§Œë“¤ì–´ì¤˜ì•¼ í•¨
- `@NoArgsContructor` : íŒŒë¼ë¯¸í„°ê°€ ì—†ëŠ” ê¸°ë³¸ ìƒì„±ì ìƒì„±
- `@AllArgsConstructor` : ëª¨ë“  í•„ë“œ ê°’ì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ” ìƒì„±ì ìƒì„±
```java
@Data
@NoArgsContructor
@AllArgsConstructor
public class ItemDto {
    private String name;
    private Integer price;
    private Integer stock;
}
```
- ì›ë¦¬ì— ë”°ë¼ 3ê°€ì§€ë¡œ ë¶„ë¥˜
1. Setter ê¸°ë°˜
2. í•„ë“œ ê¸°ë°˜ Projection
3. ìƒì„±ì ê¸°ë°˜
- ì´ë¦„ì´ ë‹¤ë¥´ë©´  nullì´ ë¨
```java
// with setters (Setter ê¸°ë°˜)
List<ItemDto> itemDtoList = queryFactory
        .select(Projections.bean(
                ItemDto.class,
                item.name,
                item.price,
                item.stock
        ))
        .from(item)
        .where(item.name.isNotNull())
        .fetch();

// with fields (í•„ë“œ ê¸°ë°˜ Projection)
        List<ItemDto> itemDtoList = queryFactory
        .select(Projections.fields(
        ItemDto.class,
        item.name,
        item.price,
        item.stock
        ))
        .from(item)
        .where(item.name.isNotNull())
        .fetch();
```
- `projections.bean()`: ì‚¬ìš©í•˜ë ¤ëŠ” DTOì˜ Setterë¥¼ ì´ìš©í•˜ëŠ” ë°©ì‹
- `projections.field()`: ì‚¬ìš©í•˜ë ¤ëŠ” DTOì˜ ì†ì„±ëª…ì— ë§ê²Œ ë°ì´í„°ë¥¼ í• ë‹¹í•˜ëŠ” ë°©ì‹, Setterë¥¼ ë§Œë“¤ì§€ ëª»í•œë‹¤ë©´ ì„ íƒí•  ìˆ˜ ìˆëŠ” ë°©ì‹
```java
// with constructor
List<ItemDto> itemDtoList = queryFactory
        .select(Projections.constructor(
                ItemDto.class,
                item.name,
                item.price,
                item.stock
        ))
        .from(item)
        .where(
                item.price.isNotNull(),
                item.stock.isNotNull()
        )
        .fetch();
```
- `Projections.constructor()`: ì‚¬ìš©í•˜ë ¤ëŠ” DTOì˜ ìƒì„±ìë¥¼ í˜¸ì¶œ,ì „ë‹¬í•œ ì†ì„± ìˆœì„œëŒ€ë¡œ ìƒì„±ìì˜ ì¸ìë¡œ ì „ë‹¬
> ğŸ’¡ ìˆœì„œê°€ ë§ì§€ ì•Šê±°ë‚˜, ë°ì´í„°ë¥¼ ë°›ì„ ìƒì„±ìê°€ ì—†ìœ¼ë©´ ì‹¤íŒ¨


- ìƒì„±ìê°€ ì§ì ‘ í˜¸ì¶œë˜ê¸° ë•Œë¬¸ì— ìƒì„±ìì— ì½”ë“œë¥¼ ì¶”ê°€í•´ ë‹¤ë¥¸ ì†ì„± ì´ˆê¸°í™”ë„ ê°€ëŠ¥
```java
@Getter
@Builder
@ToString
@NoArgsConstructor
@AllArgsConstructor
public class ItemDto {
    private String name;
    private Integer price;
    private Integer stock;
    private Integer buyAllCost;

    public ItemDto(String name, Integer price, Integer stock) {
        this.name = name;
        this.price = price;
        this.stock = stock;
        this.buyAllCost = price * stock;
    }
}
```
- ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” DTOì— ì†ì„± ì´ë¦„ì´ ì¼ì¹˜í•˜ì§€ ì•Šì„ ê²½ìš° ìƒì„±ì ë°©ì‹ì„ í™œìš©í•˜ê±°ë‚˜ `.as()`ë¥¼ ì´ìš©í•´ Alias ì„¤ì •
```java
@Getter
@Builder
@ToString
@NoArgsConstructor
@AllArgsConstructor
public class ItemDtoAs {
    private String name;
    private Integer cost;
    private Integer left;
}
```
```java
// as (alias)
List<ItemDtoAs> itemDtoList4 = queryFactory
        .select(Projections.fields(
                ItemDtoAs.class,
                item.name,
                item.price.as("cost"),
                item.stock.as("left")
        ))
        .from(item)
        .where(
                item.price.isNotNull(),
                item.stock.isNotNull())
        .fetch();
```
- ì§‘ê³„í•¨ìˆ˜ì˜ ê²°ê³¼ ì‚¬ìš©ë„ ê°€ëŠ¥
```java
@Getter
@AllArgsConstructor
@ToString
public class ItemAggDto {
    private Long count;
    private Double priceAvg;
    private Integer priceMax;
    private Integer priceMin;
}

// with aggregate group by
List<ItemAggDto> itemAggDtoList = queryFactory
        .select(Projections.constructor(
                ItemAggDto.class,
                item.count(),
                item.price.avg(),
                item.price.max(),
                item.price.min()
        ))
        .from(item)
        .join(item.shop)
        .where(item.price.isNotNull())
        .fetch();
```
- DTOë¥¼ ì‚¬ìš©í•´ ë°ì´í„°ë¥¼ ë°›ëŠ” ë°©ì‹ì˜ ë‹¨ì ì€ Querydslì˜ ì¥ì ì¸ íƒ€ì… ì•ˆì •ì„±ì´ ì¤„ì–´ë“ ë‹¤ëŠ” ì 
- ì¡°íšŒí•  ë°ì´í„°ì™€ ì†ì„±ì˜ ì´ë¦„ì„ ê°œë°œìê°€ ì •ì˜í•´ì¤˜ì•¼ í•˜ëŠ” ë§Œí¼, ì†ì„± ì´ë¦„ì˜ ì˜¤íƒ€ê°€ ìƒê¸°ë”ë¼ë„ Java ì½”ë“œ ì…ì¥ì—ì„œëŠ” ì˜¤ë¥˜ê°€ ì•„ë‹ˆë©° ì‹¤í–‰ í›„ ì†ì„±ì´ `null`ì´ ë˜ëŠ” ê²ƒì„ ë³´ê³  í˜¹ì¸í•´ì•¼ í•¨

### `@QueryProjection`
- íƒ€ì… ì•ˆì •ì„±ì„ ê°€ì ¸ê°€ë©´ì„œ íŠ¹ì •í•œ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´ `@QueryProjection` í™œìš©
- DTOì˜ ìƒì„±ìë¥¼ ë§Œë“¤ê³ , `@QueryProjection` ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•˜ë©´, í”„ë¡œì íŠ¸ë¥¼ ë¹Œë“œí•  ë•Œ, `QType` í´ë˜ìŠ¤ê°€ ë§Œë“¤ì–´ì§€ë“¯, `Q`ê°€ ë¶™ì€ DTO ìƒì„±
```java
@Getter
@Builder
@ToString
@RequiredArgsConstructor
public class ItemDto {
    private String name;
    private String description;
    private Integer price;
    private Integer stock;

    @QueryProjection
    public ItemDto(String name, String description, Integer price, Integer stock) {
        this.name = name;
        this.description = description;
        this.price = price;
        this.stock = stock;
    }
}
```
```java
public class QItemDto extends ConstructorExpression<ItemDto> {
    // ...
    public QItemDto(/* ë§¤ê°œë³€ìˆ˜ë“¤ */) {
        super(ItemDto.class, new Class<?>[]{String.class, String.class, int.class, int.class}, name, description, price, stock);
    }

}
```
- ì´ DTOëŠ” ì‹¤ì œ ë°ì´í„° ëŒ€ì‹  `QType` ì†ì„± ì •ì˜ë¥¼ ì¸ìë¡œ ë°›ëŠ” ìƒì„±ìë¥¼ ê°€ì§€ê³ 
- ì´ë¥¼ ì´ìš©í•´ `QType`ì˜ ì†ì„±ë“¤ì„ ì´ìš©í•´ `select()`ì—ì„œ ìƒì„±ì í˜¸ì¶œ ë°©ì‹ìœ¼ë¡œ í™œìš© ê°€ëŠ¥
```java
List<ItemDto> itemDtoProjList = queryFactory
        // ìƒì„±ìê°€ ì •í•´ì§€ë‹ˆê¹Œ ì»´íŒŒì¼ íƒ€ì„ ì²´í¬ê°€ ëœë‹¤.
        .select(new QItemDto(
                item.name, 
                item.description, 
                item.price, 
                item.stock
        ))
        .from(item)
        .fetch();
```
- ì´ë ‡ê²Œ ë§Œë“¤ ê²½ìš° DTO ìì²´ê°€ Querydslì˜ ê¸°ëŠ¥ê³¼ ê²°í•©(Couple)í•˜ëŠ” í–‰ìœ„
- ì¶”í›„ Querydslì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ì‚¬ê²°ì •ì´ ë°œìƒí•  ê²½ìš° ì˜ì¡´ì„± ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ!