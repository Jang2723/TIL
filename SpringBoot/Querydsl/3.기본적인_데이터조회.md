## ê¸°ë³¸ì ì¸ ë°ì´í„° ì¡°íšŒ
- Querydsl ì„ ì´ìš©í•´ ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ëŠ” ë°©ë²•

### `fetch`
- ê²°ê³¼ë¥¼ ì¡°íšŒí•  ë•ŒëŠ” `fetch`ë¡œ ì‹œì‘í•˜ëŠ” ë©”ì„œë“œ í™œìš©
- `fetch()`: ê²°ê³¼ ì „ì²´ ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
```java
List<Item> foundList = queryFactory.selectFrom(item)
        // ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
        .fetch();
```
- `fetchOne()`: ë‹¨ì¼ ê²°ê³¼ ì¡°íšŒ, ê²°ê³¼ê°€ ì—†ì„ ì‹œ `null`, 2ê°œ ì´ìƒì€ ì˜ˆì™¸ ë°œìƒ
```java
Item found = queryFactory.selectFrom(item)
        .where(item.id.eq(1L))
        // í•˜ë‚˜ë§Œ ì¡°íšŒ
        .fetchOne();

Item found = queryFactory.selectFrom(item)
        // ì—†ì„ ê²½ìš° null
        .where(item.id.eq(0L))
        .fetchOne();

queryFactory.selectFrom(item)
        // ë§ì„ ê²½ìš° Exception
        .fetchOne()
```
- `fetchFirst()`: ê²°ê³¼ ì¤‘ ì²«ë²ˆì§¸ ì¡°íšŒ(`LIMIT 1`)
```java
Item found = queryFactory.selectFrom(item)
        // ì œì¼ ì²« ê²°ê³¼ ì¡°íšŒ
        .fetchFirst();
```
- ì¶”ê°€ì ìœ¼ë¡œ `offset()`ê³¼ `limit()`ì´ ì¡´ì¬
- `offset`: ì‹œì‘ ìœ„ì¹˜ ì§€ì •
- `limit`: ì¶œë ¥ ê°œìˆ˜ ì œí•œ
```java
List<Item> foundList = queryFactory.selectFrom(item)
        .offset(3)
        .limit(2)
        .fetch();
foundList.forEach(item ->
        System.out.println(item.getId()));
```
- `fetchCount()`: ê²°ê³¼ì˜ ê°¯ìˆ˜ ë°˜í™˜
- `fetchResults()`: ê²°ê³¼ì™€ ì—°ê´€ëœ ì—¬ëŸ¬ ì •ë³´ ë°˜í™˜(ì£¼ë¡œ í˜ì´ì§€ ê´€ë ¨ ì •ë³´)
```java
// deprecated
long count = queryFactory.selectFrom(item)
        .fetchCount();

// deprecated
QueryResults<Item> results = queryFactory.selectFrom(item)
        .offset(2)
        .limit(2)
        .fetchResults();
System.out.println(results.getTotal());
System.out.println(results.getOffset());
System.out.println(results.getLimit());
// ì‹¤ì œ ì¡°íšŒ ë°ì´í„°ê°€ ìˆëŠ” ê³³
// System.out.println(results.getResults());
```

### `orderBy()`
- ê²°ê³¼ë¥¼ ì •ë ¬í•˜ê³  ì‹¶ë‹¤ë©´ SQLì—ì„œ `ORDER BY`ê°€ ë‚˜ì˜¬ ìˆœì„œì— `orderBy()`ë©”ì„œë“œ í˜¸ì¶œ
- `QType`ì„ ì´ìš©í•´ ì–´ë–¤ ì†ì„±ì„ ì–´ë–¤ ìˆœì„œë¡œ ì •ë ¬í• ì§€ ì „ë‹¬ ê°€ëŠ¥
- `QType.(ì†ì„±).(ìˆœì„œ)`ì˜ í˜•íƒœë¡œ ì‘ì„±
```java
List<Item> foundList = queryFactory.selectFrom(item)
        // item.(ì†ì„±).(ìˆœì„œ)ë¥¼ ì¼ë°˜ì ì¸ ORDER BY ì ˆì— ë„£ë“¯ ìˆœì„œëŒ€ë¡œ
        .orderBy(
                // ASCë„ ëª…ì‹œí•  ê²ƒ
                item.price.asc(),
                item.stock.desc()
        )
        .fetch();
```
- `ORDER BY item.price, item.stock DESC`ì˜ í˜•íƒœë¡œ ë“¤ì–´ê°
- `nullFirst()`ì™€ `nullLast()`ë¥¼ í™œìš©í•˜ë©´ `null` ë°ì´í„°ê°€ ê°ê° ì•ì— ë“±ì¥í• ì§€ ë’¤ì— ë“±ì¥í• ì§€ ê²°ì • ê°€ëŠ¥
```java
List<Item> foundList = queryFactory.selectFrom(item)
        // item.(ì†ì„±).(ìˆœì„œ)ë¥¼ ì¼ë°˜ì ì¸ ORDER BY ì ˆì— ë„£ë“¯ ìˆœì„œëŒ€ë¡œ
        .orderBy(
                // ASCë„ ëª…ì‹œí•  ê²ƒ
                item.price.asc(),
                item.stock.desc(),
                item.name.asc().nullsLast()
                // item.name.asc().nullsFirst()
        )
        .fetch();
```

### `where()`
- WHEREì ˆì— ì¡°ê±´ì„ ì „ë‹¬í•˜ëŠ” ê¸°ì¤€ë„ `QType`ì„ ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰
- ê°ê° ì†ì„±ì— ì •ì˜í•˜ê³  ì‹¶ì€ ì¡°ê±´ (`=`,`!=`,`LIKE`ë“±)ì— í•´ë‹¹í•˜ëŠ” ë©”ì„œë“œê°€ ì¡´ì¬
- ì¸ìë¡œëŠ” ê¸°ì¤€ì´ ë  ë°ì´í„° ì „ë‹¬ ê°€ëŠ¥
- ìµœì¢…ì ìœ¼ë¡œ `Predicate`ë¼ëŠ” ìë£Œí˜•ìœ¼ë¡œ ë§Œë“¤ì–´ì§€ë©°, ì´ë¥¼ `where()`ì˜ ì¸ìë¡œ ì „ë‹¬í•¨ìœ¼ë¡œì„œ ì¡°ê±´ ëª…ì‹œ ê°€ëŠ¥
```java
item.name.eq("itemA");        // =
item.name.ne("itemB");        // !=
// not()ì´ ë¶™ìœ¼ë©´ ì—¬íƒœê¹Œì§€ ë§Œë“  ì¡°ê±´ì˜ ë°˜ëŒ€
item.name.eq("itemC").not();  

item.shop.isNull();      // is null
item.shop.isNotNull();   // is not null
item.name.isNotEmpty();  // str.length() != 0

item.price.lt(6000);   // <  (less than)
item.price.loe(6000);  // <= (less or equal)
item.price.goe(8000);  // >= (greater or equal)
item.price.gt(8000);   // > greater than
item.price.between(5000, 10000);
item.price.in(5000, 10000);

// likeëŠ” SQL ë¬¸ë²•ëŒ€ë¡œ
item.name.like("item%");
// containsëŠ” arg -> %arg%
item.name.contains("item");
// startsWithëŠ” arg -> arg%
item.name.startsWith("item");
// endsWithëŠ” arg -> %arg
item.name.endsWith("A");

// ì‹œê°„ ê´€ë ¨
// 5ì¼ì „ ë³´ë‹¤ ë¹ ë¥¸
item.createdAt.before(LocalDateTime.now().minusDays(5));
// 5ì¼ì „ ë³´ë‹¤ ëŠ¦ì€
item.createdAt.after(LocalDateTime.now().minusDays(5));
```
- ê°„ë‹¨í•˜ê²ŒëŠ” í•˜ë‚˜ì˜ ì¡°ê±´ì„ ì „ë‹¬ 
```java
List<Item> foundItems = queryFactory.selectFrom(item)
        .where(item.name.startsWith("item"))
        .fetch();
foundItems.forEach(found ->
    System.out.printf("%s: %d", found.getName(), found.getPrice()));
```
- ê° ì¡°ê±´ì— ëŒ€í•´ `and()` ë˜ëŠ” `or()` ë©”ì„œë“œë¡œ ì—¬ëŸ¬ ì¡°ê±´ì„ ì—°ì‡„
- íŠ¹ë³„í•œ ì‘ì—…ì—†ì´ `AND`ì™€ `OR`ì„ ë§ë¶™ì¸ ë’¤ ì „ë‹¬ë°›ì€ ì¡°ê±´ì„ ì‘ì„±í•˜ëŠ” ë°©ì‹
```java
List<Item> foundItems = queryFactory.selectFrom(item)
        // and, or ë©”ì„œë“œë¡œ ì¡°ê±´ ì—°ì‡„ ê°€ëŠ¥
        // í•œë²ˆ ì‚¬ìš©í•  ë•Œë§ˆë‹¤ í˜„ì¬ ì¡°ê±´ (and | or) ì¸ì ì¡°ê±´
        .where(item.name.startsWith("item")
                .and(item.price.lt(6000))
                .or(item.price.goe(7000))
        )
        .fetch();
```
- name LIKE `item%` AND price < 6000 OR price > 7000
- `AND`ì¡°ê±´ë§Œ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ `where()`ëŠ” ê°€ë³€ì¸ìë¥¼ ë°›ê³  ìˆëŠ” ì‚¬ì‹¤ì„ ë°”íƒ•ìœ¼ë¡œ ê° ì¡°ê±´ì„ ë‚˜ì—´í•´ì„œ ë„£ì–´ ì¤„ ìˆ˜ ìˆìŒ
```java
List<Item> foundItems = queryFactory.selectFrom(item)
        // ì—¬ëŸ¬ ì¡°ê±´ì´ Varargsë¡œ ì „ë‹¬ë˜ë©´ ì „ë¶€ AND ì¡°ê±´
        .where(
                item.name.endsWith("A"),
                item.price.gt(5000)
        )
        .fetch();
```

### Joinê³¼ Fetch Join
- JPQLì²˜ëŸ¼ ì†ì„±ì„ ê¸°ì¤€ìœ¼ë¡œ JOIN
  - `join()`: INNER JOIN
  - `leftJoin()`: LEFT OUTER JOIN
  - `rightJoin()`: RIGHT OUTER JOIN
- SELECTì˜ ì£¼ê°€ë˜ëŠ” Entityì˜ ì—°ê´€ì†ì„± `QType`ê³¼ joiní•˜ê¸° ìœ„í•œ ëŒ€ìƒ `QType`ì„ `join()`ë©”ì„œë“œì— ëª…ì‹œ
```java
List<Item> foundList = queryFactory
        .selectFrom(item)
        // JPQLì—ì„œì™€ ë¹„ìŠ·í•˜ê²Œ, ì†ì„±ê³¼ JOINí•œë‹¤.
        .join(item.shop, shop)
        .where(shop.name.eq("shopA"))
        .fetch();
for (Item found: foundList) {
    System.out.println(found.getShop().getDescription());
}
```
- N+1ë¬¸ì œë¥¼ ì‚´í´ë³¼ë•Œ ì•Œì•„ë´¤ë˜ ê²ƒì²˜ëŸ¼, JOINì€ ì—°ê´€ê´€ê³„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ì§€ëŠ” ì•Šê¸° ë•Œë¬¸ì— ê° Entityë¥¼ ìˆœíšŒí•˜ë©° ì—°ê´€ê´€ê³„ Entityë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ N+1ë¬¸ì œ ë°œìƒ
> ğŸ» í˜„ì¬ ì˜ˆì‹œì—ì„œëŠ” ì‹¤ì œë¡œ ì—°ê´€ê´€ê³„ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¡°íšŒë˜ëŠ” `shop`ì˜ ì¢…ë¥˜ ìì²´ê°€ í•˜ë‚˜ì´ê¸° ë•Œë¬¸ì— N+1ì´ ë°œìƒí•´ë„ ì‹¤ì œë¡œ ì¡°íšŒë˜ëŠ” `shop`ì€ í•˜ë‚˜


### ì§‘ê³„í•¨ìˆ˜
- Entityë¥¼ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸° ë•Œë¬¸ì— `selectFrom()`ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ
- `select()`ì—ì„œ `QType`ì˜ ì†ì„±ì„ ë°”íƒ•ìœ¼ë¡œ í•´ë‹¹ ì†ì„±ì—ì„œ í™œìš©í•  ìˆ˜ ìˆëŠ” ì§‘ê³„ ë©”ì„œë“œë¥¼ ì´ìš©í•´ íŠ¹ì • ì†ì„±ì˜ ì§‘ê³„ë¥¼ í•˜ê³  ì‹¶ìŒì„ ë‚˜íƒ€ë‚¼ ìˆ˜ëŠ” ìˆìŒ
```java
Tuple foundList = queryFactory
        .select(
                item.count(),
                item.price.avg(),
                item.price.min(),
                item.price.max(),
                item.stock.sum()
        )
        .from(item)
        .fetchOne();
```
- ë°˜í™˜í˜•ì´ ë˜ëŠ” `Tuple`ì€ `QType`ì„ ê¸°ë°˜ìœ¼ë¡œ ì—´ ë°ì´í„°ë¥¼ ì €ì¥í•´ë‘ëŠ” ì¸í„°í˜ì´ìŠ¤
- ì—´ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ `QType`ìœ¼ë¡œ ì»¬ëŸ¼ì„ ì§€ì •í•´ì„œ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŒ
```java
System.out.println(result.get(item.count()));
System.out.println(result.get(item.price.avg()));
System.out.println(result.get(item.price.min()));
System.out.println(result.get(item.price.max()));
System.out.println(result.get(item.stock.sum()));
```
- `groupBy()`ë¡œ ê·¸ë£¹ì§€ì–´ì„œ ì—°ì‚° ê°€ëŠ¥
- `List<Tuple>`ë¡œ ë°˜í™˜
```java
List<Tuple> results = queryFactory
        .select(
                shop.name,
                item.count(),
                item.price.avg(),
                item.price.min(),
                item.price.max(),
                item.stock.sum()
        )
        .from(item)
        .join(item.shop, shop)
        .groupBy(shop.name)
        .fetch();


results.forEach(result -> System.out.printf(
        "%s: %.2f, %d%n",
        result.get(shop.name),
        result.get(item.price.avg()),
        result.get(item.stock.sum())
));
```
---
### **ì°¸ê³ **
>ğŸ’¡ `Tuple` ì€ ë‹¨ìˆœíˆ ì—¬ëŸ¬ ì»¬ëŸ¼ì„ ì§€ì •í•´ì„œ ì¡°íšŒí•˜ê³  ì‹¶ì„ë•Œë„ í™œìš© ê°€ëŠ¥
>   ```java
>   List<Tuple> results = queryFactory
>            .select(item.name, item.price)
>            .from(item)
>            .fetch();
>    
>    results.forEach(tuple -> System.out.printf(
>            "%s: %d%n",
>            tuple.get(item.name),
>            tuple.get(item.price)
>    ));
>    ```
